<h2 id="comment-compiler-une-mission">Comment compiler une mission ?</h2>
<h3 id="prérequis">Prérequis</h3>
<h4 id="installation-manuelle">Installation manuelle</h4>
<p>Vous aurez besoin de quelques outils installés sur votre PC pour que ces scripts fonctionnent.</p>
<ul>
<li>LUA : il vous faudra un interpreter LUA, dans votre PATH, prêt à être appelé avec la commande <code>lua</code></li>
<li>7zip : il vous faudra 7zip, ou un autre outil de compression ZIP, dans votre PATH, prêt à être appelé avec la commande <code>7zip</code></li>
<li>Powershell : vous aurez besoin de Powershell, et il faudra le configurer pour qu’il soit autorisé à exécuter des scripts (lire <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/set-executionpolicy?view=powershell-7.1">cet article en anglais</a>) ; dit simplement, vous devez lancer cette commande dans une fenêtre Powershell (en mode administrateur) : <code>Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope LocalMachine</code></li>
<li>npm : il vous faudra le gestionnaire de modules de NodeJS, NPM, pour récupérer automatiquement les outils de création de mission VEAF ; voir <a href="https://www.npmjs.com/get-npm">ici (en anglais)</a></li>
</ul>
<h4 id="installation-avec-chocolatey">Installation avec Chocolatey</h4>
<p>Ces outils nécessaires peuvent être installés facilement en utilisant <em>Chocolatey</em> (voir <a href="https://chocolatey.org/">ici (en anglais)</a>).</p>
<p><strong>ATTENTION</strong> : il ne faut surtout pas installer deux fois les outils, avec <em>l’installation manuelle</em> et <em>l’installation par Chocolatey</em> ! C’est <strong>l’un ou l’autre</strong> !</p>
<p>Pour installer Chocolatey, lancez cette commande dans une fenêtre Powershell (en mode administrateur) : <code>Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))</code></p>
<p>Une fois que <em>Chocolatey</em> est installé, vous pouvez installer les outils à l’aide de ces simples commandes (dans une fenêtre <em>cmd</em> standard) :</p>
<ul>
<li>LUA : <code>choco install -y lua</code></li>
<li>7zip : <code>choco install -y 7zip.commandline</code></li>
<li>npm : <code>choco install -y nodejs</code></li>
</ul>
<h3 id="compiler-une-mission">Compiler une mission</h3>
<p>C’est facile de compiler une mission à partir des sources ; il suffit de lancer le script <code>build.cmd</code>. Vous n’avez même pas besoin de le lancer dans une invite de commande <code>cmd</code>, il suffit de double-cliquer dessus.</p>
<p>Le processus va prendre tous les fichiers du répertoire <code>src</code>, récupérer la dernière version des outils <em>VEAF Mission Creation Tools</em> (à partir de GitHub), et compiler tout ça dans une mission prête à l’emploi pour DCS (dans un fichier <code>.miz</code>)</p>
<p>Ce fichier aura le même nom que la mission (configuré dans la première ligne du script <code>build.cmd</code>), et placé dans le répertoire <code>build</code>.</p>
<h3 id="editer-une-version-compilée">Editer une version compilée</h3>
<p>Une fois la mission compilée, copiez-là du répertoire <code>build</code> vers le répertoire de la mission (celui dans lequel se trouvent <code>extract.cmd</code> et <code>build.cmd</code>). Ensuite, ouvrez-la dans l’éditeur de mission de DCS, et éditez-la (ajouter/supprimer des unités, ajouter des triggers, changer des zones, etc.).</p>
<p>Egalement, vous pouvez éditer les fichiers source de la mission en parallèle (en utilisant un éditeur de texte, je conseille Notepad++ ou Visual Studio Code); en particulier, vous pouvez éditer :</p>
<ul>
<li>le fichier de configuration de la mission <code>src/scripts/missionConfig.lua</code>, pour définir les paramètres de la mission ; c’est le principal fichier source que vous éditerez.</li>
<li>le fichier des canaux radio <code>src/radio/radioSettings.lua</code>, pour définir les canaux radio qui seront poussés dans les avions.</li>
<li>les presets pour la météo dans <code>src/weatherAndTime</code></li>
</ul>
<p>So vous éditez un de ces fichiers, et parce qu’ils sont intégrés <em>dans</em> le fichier <code>.miz</code> de la mission, vous devrez <em>recompiler</em> la mission avant de pouvoir tester vos changements dans le jeu.</p>
<p>Il existe un moyen de tester facilement ces changements : le premier trigger de la mission contient une condition LUA, qui conditionne la méthode de chargement des scripts. Si elle est à <code>false</code>, les scripts seront chargés statiquement (i.e. ils seront chargés <em>à partir de la mission</em>) ; si elle est à <code>true</code>, les scripts seront chargés dynamiquement, et donc à chaque redémarrage de la mission dans DCS (ShiftGauche + R), vous pourrez tester les changements apportés aux fichiers.</p>
<figure>
<img src="https://user-images.githubusercontent.com/172286/109670752-bac72180-7b73-11eb-9d20-cadd84bff1a5.jpg" alt="triggers" /><figcaption aria-hidden="true">triggers</figcaption>
</figure>
<h3 id="extraire-une-mission-éditée">Extraire une mission éditée</h3>
<p>Une fois qu’une mission a été éditée et sauvée dans l’éditeur de mission de DCS, il faut <em>extraire</em> son contenu dans le répertoire <code>src</code>, afin de pouvoir le réinjecter plus tard avec le script <code>build</code>.</p>
<p>Pour ce faire, il suffit de lancer le script <code>extract.cmd</code>. Vous n’avez même pas besoin de le lancer dans une invite de commande <code>cmd</code>, il suffit de double-cliquer dessus.</p>
<p>Ce script va prendre n’importe quel fichier dont le nom commence par le nom de la mission (configuré dans la première ligne du script <code>extract.cmd</code>), dans le répertoire de la mission (celui dans lequel se trouvent <code>extract.cmd</code> et <code>build.cmd</code>, pas le répertoire <code>build</code>), extraire son contenu, le traiter et le stocker dans <code>src</code>.</p>
<h3 id="paramètres-avancés">Paramètres avancés</h3>
<h4 id="spécifier-lemplacement-de-lexécutable-7zip">Spécifier l’emplacement de l’exécutable 7zip</h4>
<p>Si l’outil 7zip est installé mais n’est pas dans votre PATH, vous pouvez spécifier son emplacement dans la variable d’environnement <code>SEVENZIP</code>. C’est une chaine qui doit pointer vers l’exécutable <code>7za</code> (par ex: <code>c:\tools\7zip\bin\7zip.exe</code>)</p>
<h4 id="spécifier-lemplacement-de-lexécutable-lua">Spécifier l’emplacement de l’exécutable LUA</h4>
<p>De la même manière, vous pouvez spécifier son emplacement dans la variable d’environnement <code>LUA</code>. C’est une chaine qui doit pointer vers l’exécutable <code>lua</code> (par ex: <code>c:\tools\lua\bin\lua.exe</code>)</p>
<h4 id="ne-pas-marquer-de-pause">Ne pas marquer de pause</h4>
<p>Si vous précisez la valeur “true” dans la variable d’environnement <code>NOPAUSE</code>, alors les scripts se déroulera sans marquer de pause.</p>
<h2 id="comment-transformer-une-mission-existante---version-graphique">Comment transformer une mission existante - version graphique</h2>
<figure>
<img src="https://user-images.githubusercontent.com/172286/109006666-9a96ee80-76ab-11eb-871c-a77a1ffa4fd9.jpg" alt="schema" /><figcaption aria-hidden="true">schema</figcaption>
</figure>
